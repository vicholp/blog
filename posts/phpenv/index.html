<!doctype html><html lang=es><head><title>Usando phpenv en WSL2 y Github Actions ::
Vicente Lineros Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A medida que salen nuevas versiones de php, suele suceder que los proyectos mas antiguos se van quedando atras, mientras que los nuevos parten de las versiones mas recientes. Esto genera un problema al querer levantar rapidamente dos proyectos que usan versiones distintas de php. Para esto existe con .
Con phpenv instalado, al ejecutar php en una consola, el comando sera ejecutado por la version que se tenga configurada."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://vicholp.github.io/blog/posts/phpenv/><link rel=stylesheet href=https://vicholp.github.io/blog/assets/style.css><link rel=stylesheet href=https://vicholp.github.io/blog/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://vicholp.github.io/blog/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://vicholp.github.io/blog/img/favicon.png><link href=https://vicholp.github.io/blog/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://vicholp.github.io/blog/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://vicholp.github.io/blog/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://vicholp.github.io/blog/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://vicholp.github.io/blog/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://vicholp.github.io/blog/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="Usando phpenv en WSL2 y Github Actions"><meta name=twitter:description content="A medida que salen nuevas versiones de php, suele suceder que los proyectos mas antiguos se van quedando atras, mientras que los nuevos parten de las versiones mas recientes. Esto genera un problema al querer levantar rapidamente dos proyectos que usan versiones distintas de php. Para esto existe con .
Con phpenv instalado, al ejecutar php en una consola, el comando sera ejecutado por la version que se tenga configurada."><meta property="og:title" content="Usando phpenv en WSL2 y Github Actions"><meta property="og:description" content="A medida que salen nuevas versiones de php, suele suceder que los proyectos mas antiguos se van quedando atras, mientras que los nuevos parten de las versiones mas recientes. Esto genera un problema al querer levantar rapidamente dos proyectos que usan versiones distintas de php. Para esto existe con .
Con phpenv instalado, al ejecutar php en una consola, el comando sera ejecutado por la version que se tenga configurada."><meta property="og:type" content="article"><meta property="og:url" content="https://vicholp.github.io/blog/posts/phpenv/"><meta property="article:published_time" content="2019-03-26T08:47:11+01:00"><meta property="article:modified_time" content="2019-03-26T08:47:11+01:00"><meta property="og:site_name" content="Vicente Lineros Blog"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/blog class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Vicente Lineros</span>
<span class=logo__cursor></span></a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/blog/about>About</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/blog/about>About</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>Usando phpenv en WSL2 y Github Actions</h1><div class=post-meta><span class=post-date>2019-03-26</span></div><div class=post-content><p>A medida que salen nuevas versiones de php, suele suceder que los proyectos mas antiguos se van quedando atras, mientras que los nuevos parten de las versiones mas recientes.
Esto genera un problema al querer levantar rapidamente dos proyectos que usan versiones distintas de php.
Para esto existe con .</p><p>Con <a href=https://github.com/phpenv/phpenv><code>phpenv</code></a> instalado, al ejecutar <code>php</code> en una consola, el comando sera ejecutado por la version que se tenga configurada.</p><p>Con <a href=https://github.com/php-build/php-build><code>phpenv-build</code></a>, podremos compilar rapidamente las versiones de php que necesitemos.</p><p>Con <a href=https://github.com/madumlao/phpenv-aliases><code>phpenv-aliases</code></a>, podremos asignar aliases entre versiones de php. Este paquete no es realmente necesario, pero si muy util.</p><p>De esta forma, en local basta con ejecutar <code>php</code> para usar la version correspondiente, y ademas, github actions instalara la misma version que se usa en local.</p><h2 id=instalar-en-wsl>Instalar en WSL</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone git://github.com/phpenv/phpenv.git ~/.phpenv

echo <span style=color:#e6db74>&#39;export PATH=&#34;$HOME/.phpenv/bin:$PATH&#34;&#39;</span> &gt;&gt; ~/.bashrc

echo <span style=color:#e6db74>&#39;eval &#34;$(phpenv init -)&#34;&#39;</span> &gt;&gt; ~/.bashrc
</code></pre></div><p>Reiniciar la consola para aplicar los cambios:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>exit
wsl
</code></pre></div><p>Instalando <code>phpenv-build</code> y <code>phpenv-alias</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone https://github.com/php-build/php-build <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>phpenv root<span style=color:#66d9ef>)</span><span style=color:#e6db74>/plugins/php-build&#34;</span>

git clone git://github.com/madumlao/phpenv-aliases.git <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>phpenv root<span style=color:#66d9ef>)</span><span style=color:#e6db74>/plugins/phpenv-aliases&#34;</span>
</code></pre></div><p>Para compilar php (al menos la version 7.4) es necesario instalar estos paquetes:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo apt-get install -y pkg-config libbz2-dev autoconf automake bison <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>build-essential curl flex libtool libssl-dev libxml2-dev <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>libreadline8 libreadline-dev libsqlite3-dev libzip-dev libzip5 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>openssl pkg-config re2c sqlite3 zlib1g-dev libonig5 libonig-dev <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>libcurl4-openssl-dev libpng-dev libjpeg-dev libtidy-dev
</code></pre></div><p><em>Otras versiones de php pueden requirir otros paquetes.</em></p><h2 id=configurar>Configurar</h2><p>Instalar y compilar php, y crear los aliases:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>phpenv install 7.4.20
phpenv alias --auto
</code></pre></div><p>Configurar la version instalada en el repositorio actual:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>phpenv local 7.4.20
</code></pre></div><p>Esto creara el archivo <code>.php-version</code> con la version configurada localmente. Este archivo sera leido por <code>phpenv</code> al ejecutar el comando <code>php</code>.</p><h2 id=workflow-de-gh-actions>Workflow de GH Actions</h2><p>Para usar en Github Actions, basta con leer el archivo, y configurar php:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>build</span>:
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
    <span style=color:#f92672>steps</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Read phpenv-version</span>
            <span style=color:#f92672>id</span>: <span style=color:#ae81ff>php-version</span>
            <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>juliangruber/read-file-action@v1</span>
            <span style=color:#f92672>with</span>:
                <span style=color:#f92672>path</span>: <span style=color:#ae81ff>.php-version</span>

        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Setup PHP</span>
            <span style=color:#f92672>id</span>: <span style=color:#ae81ff>setup-php</span>
            <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>bashivammathur/setup-php@v2</span>
            <span style=color:#f92672>with</span>:
                <span style=color:#f92672>php-version</span>: <span style=color:#ae81ff>${{ steps.php-version.outputs.content }}</span>
</code></pre></div></div></div></div><footer class=footer><div class=footer__inner><a href=/blog class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Vicente Lineros</span>
<span class=logo__cursor></span></a><div class=copyright><span>Â© 2022 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://vicholp.github.io/blog/assets/main.js></script><script src=https://vicholp.github.io/blog/assets/prism.js></script></div></body></html>